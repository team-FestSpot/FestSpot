<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.festspot.dev.domain.post.PostMapper">

    <resultMap id="PostMap" type="com.festspot.dev.domain.post.Post">
        <id property="postId" column="post_id" />
        <result property="userId" column="user_id" />
        <result property="postCategoryId" column="post_category_id" />
        <result property="postTitle" column="post_title" />
        <result property="postContent" column="post_content" />
        <result property="allowComments" column="allow_comments" />
        <result property="viewCount" column="view_count" />
        <result property="commentCount" column="comment_count" />
        <result property="createdAt" column="created_at" />
        <result property="updatedAt" column="updated_at" />
        <association property="user" resultMap="UserMap" />
        <collection property="postImgs" javaType="list" resultMap="PostImgMap" />
    </resultMap>

    <resultMap id="UserMap" type="com.festspot.dev.domain.user.User">
        <id property="userId" column="user_id" />
        <result property="userNickName" column="user_nickname" />
        <result property="userProfileImgUrl" column="user_profile_img_url" />
    </resultMap>

    <resultMap id="PostImgMap" type="com.festspot.dev.domain.postImg.PostImg">
        <id property="postImgId" column="post_img_id" />
        <result property="seq" column="seq" />
        <result property="postId" column="post_id" />
        <result property="postImgUrl" column="post_img_url" />
    </resultMap>

    <insert id="insert" useGeneratedKeys="true" keyProperty="postId">
        insert into post_tb
        values (default, #{userId}, #{postTitle}, #{postContent}, #{allowComments}, now())
    </insert>

    <select id="findByPostId" resultType="com.festspot.dev.domain.post.Post">
        select
            *
        from
            post_tb pt
            left outer join user_tb ut on(ut.user_id = pt.user_id)
            left outer join post_img_tb pit on(pit.post_id = pt.post_id)
            left outer join post_like_tb plt on(plt.post_id = pt.post_id and flt.user_id = #{userId})
        where
            pt.post_id = #{postId}


    </select>


</mapper>