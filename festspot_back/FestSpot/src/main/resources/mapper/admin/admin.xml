<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.festspot.dev.domain.admin.AdminMapper">
    <insert id="insert" keyProperty="performanceId" useGeneratedKeys="true">
        insert ignore into performance_tb (
            performance_api_id,
            performance_title,
            performance_cast
            performance_poster_url,
            performance_start_date,
            performance_end_date,
            performance_venue,
            performance_last_modified,
            is_foreign,
            is_festival,
            updated_at
        )
        values (
            #{performanceRegionId},
            #{performanceApiId},
            #{performanceTitle},
            #{performanceCast},
            #{performancePosterUrl},
            #{performanceStartDate},
            #{performanceEndDate},
            #{performanceVenue},
            #{performanceStatus},
            #{performanceLastModified},
            #{isForeign},
            #{isFestival},
            #{updatedAt}
        )
    </insert>

    <insert id="insertMany" keyProperty="performanceId" parameterType="java.util.List" useGeneratedKeys="true">
        insert ignore into performance_tb (
            performance_api_id,
            performance_title,
            performance_cast,
            performance_poster_url,
            performance_start_date,
            performance_end_date,
            performance_venue,
            performance_last_modified,
            is_foreign,
            is_festival,
            updated_at
        )
        values
            <foreach collection="list" index="index" item="performance" separator=",">
                (#{performance.performanceRegionId},
                #{performance.performanceApiId},
                #{performance.performanceTitle},
                #{performance.performanceCast}),
                #{performance.performancePosterUrl},
                #{performance.performanceStartDate},
                #{performance.performanceEndDate},
                #{performance.performanceVenue},
                #{performance.performanceStatus},
                #{performance.performanceLastModified},
                #{performance.isForeign},
                #{performance.isFestival},
                #{performance.updatedAt}
            </foreach>
    </insert>



    <resultMap id="PerformanceMap" type="com.festspot.dev.domain.performance.Performance">
        <id column="performance_id" property="performanceId" />
        <result column="performance_api_id" property="performanceApiId" />
        <result column="performance_title" property="performanceTitle" />
        <result column="performance_cast" property="performanceCast" />
        <result column="performance_poster_url" property="performancePosterUrl" />
        <result column="performance_start_date" property="performanceStartDate" />
        <result column="performance_end_date" property="performanceEndDate" />
        <result column="performance_venue" property="performanceVenue" />
        <result column="performance_last_modified" property="performanceLastModified" />
        <result column="is_foreign" property="isForeign" />
        <result column="is_festival" property="isFestival" />
        <result column="updated_at" property="updatedAt" />
        <association property="performanceRegion" resultMap="PerformanceRegionMap" />
        <association property="performanceState" resultMap="PerformanceStateMap" />
        <collection javaType="list" property="ticketingUrls" resultMap="TicketingUrlMap" />
    </resultMap>
    <resultMap id="PerformanceRegionMap" type="com.festspot.dev.domain.performance.performanceRegion.PerformanceRegion">
        <id column="performance_region_id" property="performanceRegionId" />
        <result column="region_code" property="regionCode" />
        <result column="region_name" property="regionName" />
    </resultMap>
    <resultMap id="PerformanceStateMap" type="com.festspot.dev.domain.performance.performanceState.PerformanceState">
        <id column="performance_state_id" property="performanceStateId" />
        <result column="performance_state" property="performanceState" />
    </resultMap>
    <resultMap id="TicketingUrlMap" type="com.festspot.dev.domain.ticketing.TicketingUrl">
        <id column="ticketing_url_id" property="ticketingUrlId" />
        <result column="performance_id" property="performanceId" />
        <result column="ticketing_url" property="ticketingUrl" />
        <result column="ticketing_agency_name" property="ticketingAgencyName" />
    </resultMap>

    <select id="getRegionCodeByRegionName" resultType="java.lang.Integer">
        select
            region_code
        from
            region_tb
        where
            region_name = #{regionName}
    </select>

    <select id="getStateCodeByState" resultType="java.lang.Integer">
        select
            performance_state_id
        from
            performance_state_tb
        where
            performance_state = #{state}
    </select>

    <select id="findByPerformanceApiId" resultType="com.festspot.dev.domain.performance.Performance">
        select
            *
        from
            performance_tb
        where
            performance_api_id = #{performanceApiId}
    </select>
</mapper>