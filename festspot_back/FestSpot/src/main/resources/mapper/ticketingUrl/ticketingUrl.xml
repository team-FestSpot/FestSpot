<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.festspot.dev.domain.ticketing.TicketingUrlMapper">
    <insert id="insert" keyProperty="ticketingUrlId" useGeneratedKeys="true">
        insert into ticketing_url_tb (
            ticketing_url_id,
            performance_id,
            ticketing_url,
            ticketing_agency_name
        )
        values
        <foreach collection="list" item="relates" separator=",">
            (
                <choose>
                    <when test="relates.ticketingUrlId == null">
                        default,
                    </when>
                    <otherwise>
                        #{relates.ticketingUrlId},
                    </otherwise>
                </choose>
                    #{relates.performanceId},
                    #{relates.ticketingUrl},
                    #{relates.ticketingAgencyName}
            )
         </foreach>
        as new
        on duplicate key update
            ticketing_url = new.ticketing_url,
            ticketing_agency_name = new.ticketing_agency_name
    </insert>

    <insert id="insertMany">
        insert into ticketing_url_tb
        values
        <foreach collection="list" item="manyTicketingUrls" separator=",">
            <foreach collection="manyTicketingUrls" item="ticketingUrl" separator=",">
                (default,
                #{ticketingUrl.performanceId},
                #{ticketingUrl.ticketingUrl},
                #{ticketingUrl.ticketingAgencyName})
            </foreach>
        </foreach>
    </insert>

    <delete id="deleteMissing">
        delete from ticketing_url_tb
        where (performance_id, ticketing_url_id) in
        <foreach collection="list" item="relate" open="(" separator="," close=")">
            (#{relate.performanceId}, #{relate.ticketingUrlId})
        </foreach>
    </delete>

    <delete id="deleteManyByPerformanceIds">
        delete from ticketing_url_tb
        where performance_id in
        <foreach collection="list" item="performanceId" open="(" separator="," close=")">
            #{performanceId}
        </foreach>
    </delete>

    <select id="findByPerformanceId" resultType="java.util.List">
        select
            *
        from
            ticketing_url_tb
        where

    </select>

    <resultMap id="TicketingUrlMap" type="com.festspot.dev.domain.ticketing.TicketingUrl">
        <id column="ticketing_url_id" property="ticketingUrlId" />
        <result column="performance_id" property="performanceId" />
        <result column="ticketing_url" property="ticketingUrl" />
        <result column="ticketing_agency_name" property="ticketingAgencyName" />
    </resultMap>
</mapper>